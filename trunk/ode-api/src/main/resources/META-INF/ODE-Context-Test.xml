<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context-4.0.xsd">

    <context:component-scan base-package="com.leidos.ode"/>

    <!--&lt;!&ndash; Load Properties file &ndash;&gt;-->
    <!--<bean id="properties" class="org.springframework.beans.factory.config.PropertiesFactoryBean" scope="prototype">-->
    <!--<property name="ignoreResourceNotFound" value="true"/>-->
    <!--&lt;!&ndash;-->
    <!--Allow for the (optional) override of these properties-->
    <!--&ndash;&gt;-->
    <!--<property name="locations">-->
    <!--<list>-->
    <!--<value>classpath:META-INF/ODE-Context-Dev.properties</value>-->
    <!--</list>-->
    <!--</property>-->
    <!--</bean>-->

    <bean id="propertyPlaceholderConfigurer"
          class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="locations">
            <list>
                <value>classpath:META-INF/ODE-Context-Dev.properties</value>
            </list>
        </property>
        <!-- This means don't blow up if a property is not set -->
        <property name="ignoreUnresolvablePlaceholders" value="true"/>
        <!--
        This means that any system properties set on the command line will take precedence over those set locally or in a properties file.
        -->
        <property name="systemPropertiesModeName" value="SYSTEM_PROPERTIES_MODE_OVERRIDE"/>
    </bean>

    <bean id="dateFormat" class="java.text.SimpleDateFormat">
        <constructor-arg value="MM-dd-YYYY"/>
    </bean>

    <bean id="ODELogger" class="com.leidos.ode.logging.ODELogger">
        <property name="mongoTemplate" ref="mongoTemplate"/>
    </bean>

    <bean id="BasicSubRegistration" class="com.leidos.ode.agent.registration.BasicODERegistration">
        <property name="registrationBaseUrl" value="${leidos.ode.reg.baseurl}"/>
        <property name="registrationEndpoint" value="${leidos.ode.reg.sub.endpoint}"/>
    </bean>

    <bean id="BasicPubRegistration" class="com.leidos.ode.agent.registration.BasicODERegistration">
        <property name="registrationBaseUrl" value="${leidos.ode.reg.baseurl}"/>
        <property name="registrationEndpoint" value="${leidos.ode.reg.pub.endpoint}"/>
    </bean>

    <bean id="BSMParser" class="com.leidos.ode.agent.parser.BSMParser"/>

    <bean id="QueueTarget" class="com.leidos.ode.agent.datatarget.ODEQueueTarget"/>
    
    <bean id="RESTTarget" class="com.leidos.ode.agent.datatarget.ODERestTarget"/>

    <bean id="VDOTParser" class="com.leidos.ode.agent.parser.VDOTParser"/>

    <bean id="RITISParser" class="com.leidos.ode.agent.parser.RITISParser"/>

    <bean id="PassthroughSanitizer" class="com.leidos.ode.agent.sanitizer.PassthroughSanitizer"/>

    
    <bean id="PushDataSource" class="com.leidos.ode.collector.datasource.PushDataSource" abstract="true"/>

    <bean id="RestPullDataSource" class="com.leidos.ode.collector.datasource.RestPullDataSource" abstract="true"/>

    <bean id="UDPPushDataSource" class="com.leidos.ode.collector.datasource.UDPPushDataSource" parent="PushDataSource">

    </bean>
    
    
    <bean id="BSMSUBRegistrationInfo" class="com.leidos.ode.core.registration.RegistrationInformation">
        <property name="messageType" value="${leidos.ode.emulator.bsm.messageType}"/>
        <property name="region" value="${leidos.ode.emulator.bsm.region}"/>
        <property name="registrationType" value="${leidos.ode.emulator.bsm.sub.registrationType}"/>
        <property name="agentId" value="${leidos.ode.emulator.bsm.sub.agentId}"/>
        <property name="subscriptionReceiveAddress" value="${leidos.ode.emulator.bsm.hostAddress}"/>
        <property name="subscriptionReceivePort" value="${leidos.ode.emulator.bsm.hostPort}"/>
        <property name="startDate">
            <bean factory-bean="dateFormat" factory-method="parse">
                <constructor-arg value="${leidos.ode.emulator.bsm.sub.startDate}"/>
            </bean>
        </property>
        <property name="endDate">
            <bean factory-bean="dateFormat" factory-method="parse">
                <constructor-arg value="${leidos.ode.emulator.bsm.sub.endDate}"/>
            </bean>
        </property>
    </bean>

    <bean id="BSMSUBDataSource" class="com.leidos.ode.collector.datasource.UDPPushDataSource" parent="PushDataSource">
        <property name="hostProtocol" value="${leidos.ode.emulator.bsm.hostProtocol}"/>
        <property name="hostAddress" value="${leidos.ode.emulator.bsm.hostAddress}"/>
        <property name="hostPort" value="${leidos.ode.emulator.bsm.hostPort}"/>
    </bean>

    <bean id="BSMSubRegistration" class="com.leidos.ode.agent.registration.BasicODERegistration">
        <property name="registrationBaseUrl" value="${leidos.ode.reg.baseurl}"/>
        <property name="registrationEndpoint" value="${leidos.ode.reg.sub.endpoint}"/>
    </bean>

    <bean id="BSMDataTarget" class="com.leidos.ode.agent.datatarget.ODEFileDataTarget">
    </bean>

    <bean id="BSMSubAgent" class="com.leidos.ode.agent.SubscribeODEAgent">
        <property name="registration" ref="BSMSubRegistration"/>
        <property name="parser" ref="BSMParser"/>
        <property name="sanitizer" ref="PassthroughSanitizer"/>
        <property name="dataTarget" ref="BSMDataTarget"/>
        <property name="registrationInformation" ref="BSMSUBRegistrationInfo"/>
        <property name="odeLogger" ref="ODELogger"/>
    </bean>

    <bean id="BSMSUBCollector" class="com.leidos.ode.collector.ODECollector">
        <property name="agent" ref="BSMSubAgent"/>
        <property name="dataSource" ref="BSMSUBDataSource"/>
    </bean>

</beans>