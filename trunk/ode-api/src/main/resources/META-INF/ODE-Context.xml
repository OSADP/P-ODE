<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context-4.0.xsd">

    <context:component-scan base-package="com.leidos.ode"/>

    <!--&lt;!&ndash; Load Properties file &ndash;&gt;-->
    <!--<bean id="properties" class="org.springframework.beans.factory.config.PropertiesFactoryBean" scope="prototype">-->
    <!--<property name="ignoreResourceNotFound" value="true"/>-->
    <!--&lt;!&ndash;-->
    <!--Allow for the (optional) override of these properties-->
    <!--&ndash;&gt;-->
    <!--<property name="locations">-->
    <!--<list>-->
    <!--<value>classpath:META-INF/ODEContext-Dev.properties</value>-->
    <!--</list>-->
    <!--</property>-->
    <!--</bean>-->

    <bean id="propertyPlaceholderConfigurer"
          class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="locations">
            <list>
                <value>classpath:META-INF/ODEContext-Dev.properties</value>
                <value>classpath:publisher.properties</value>
                <value>classpath:ritisfilter.properties</value>
                <value>classpath:vdotfeeds.properties</value>
            </list>
        </property>
        <!-- This means don't blow up if a property is not set -->
        <property name="ignoreUnresolvablePlaceholders" value="true"/>
        <!--
        This means that any system properties set on the command line will take precedence over those set locally or in a properties file.
        -->
        <property name="systemPropertiesModeName" value="SYSTEM_PROPERTIES_MODE_OVERRIDE"/>
    </bean>

    <bean id="dateFormat" class="java.text.SimpleDateFormat">
        <constructor-arg value="MM-dd-YYYY"/>
    </bean>

    <bean id="ODELogger" class="com.leidos.ode.logging.ODELogger">
        <property name="mongoTemplate" ref="mongoTemplate"/>
    </bean>

    <bean id="BasicSubRegistration" class="com.leidos.ode.agent.registration.BasicODERegistration">
        <property name="registrationBaseUrl" value="${leidos.ode.reg.baseurl}"/>
        <property name="registrationEndpoint" value="${leidos.ode.reg.sub.endpoint}"/>
    </bean>

    <bean id="BasicPubRegistration" class="com.leidos.ode.agent.registration.BasicODERegistration">
        <property name="registrationBaseUrl" value="${leidos.ode.reg.baseurl}"/>
        <property name="registrationEndpoint" value="${leidos.ode.reg.pub.endpoint}"/>
    </bean>

    <bean id="BSMParser" class="com.leidos.ode.agent.parser.BSMParser"/>

    <bean id="QueueTarget" class="com.leidos.ode.agent.datatarget.ODEQueueTarget"/>
    
    <bean id="RESTTarget" class="com.leidos.ode.agent.datatarget.ODERestTarget"/>

    <bean id="VDOTParser" class="com.leidos.ode.agent.parser.VDOTParser"/>

    <bean id="RITISParser" class="com.leidos.ode.agent.parser.RITISParser"/>

    <bean id="PassthroughSanitizer" class="com.leidos.ode.agent.sanitizer.PassthroughSanitizer"/>

    <bean id="TestRegistrationInfo" class="com.leidos.ode.core.registration.RegistrationInformation">
        <property name="messageType" value="${leidos.ode.reg.test.pub.messageType}"/>
        <property name="region" value="${leidos.ode.reg.test.pub.region}"/>
        <property name="registrationType" value="${leidos.ode.reg.test.pub.registrationType}"/>
        <property name="agentId" value="${leidos.ode.reg.test.pub.agentId}"/>
        <property name="startDate">
            <bean factory-bean="dateFormat" factory-method="parse">
                <constructor-arg value="${leidos.ode.reg.test.pub.startDate}"/>
            </bean>
        </property>
        <property name="endDate">
            <bean factory-bean="dateFormat" factory-method="parse">
                <constructor-arg value="${leidos.ode.reg.test.pub.endDate}"/>
            </bean>
        </property>
        <property name="subscriptionReceiveAddress" value="${leidos.ode.reg.test.sub.receiveAddress}"/>
        <property name="subscriptionReceivePort" value="${leidos.ode.reg.test.sub.receivePort}"/>
    </bean>

    <bean id="BSMPubRegistrationInfo" class="com.leidos.ode.core.registration.RegistrationInformation">
        <property name="messageType" value="${leidos.ode.reg.bsm.pub.messageType}"/>
        <property name="region" value="${leidos.ode.reg.bsm.pub.region}"/>
        <property name="registrationType" value="${leidos.ode.reg.bsm.pub.registrationType}"/>
        <property name="agentId" value="${leidos.ode.reg.bsm.pub.agentId}"/>
        <property name="startDate">
            <bean factory-bean="dateFormat" factory-method="parse">
                <constructor-arg value="${leidos.ode.reg.bsm.pub.startDate}"/>
            </bean>
        </property>
        <property name="endDate">
            <bean factory-bean="dateFormat" factory-method="parse">
                <constructor-arg value="${leidos.ode.reg.bsm.pub.endDate}"/>
            </bean>
        </property>
    </bean>

    <bean id="BSMPubAgent" class="com.leidos.ode.agent.PublishODEAgent">
        <property name="registration" ref="BasicPubRegistration"/>
        <property name="parser" ref="BSMParser"/>
        <property name="sanitizer" ref="PassthroughSanitizer"/>
        <property name="dataTarget" ref="RESTTarget"/>
        <property name="registrationInformation" ref="TestRegistrationInfo"/>
        <property name="odeLogger" ref="ODELogger"/>
    </bean>
    
    <bean id="BSMUDPPushDataSource" class="com.leidos.ode.collector.datasource.UDPPushDataSource">
    </bean>
    
    <bean id="RITISFilterCollector" class="com.leidos.ode.collector.ODECollector">
        <property name="agent" ref="BSMPubAgent"/>
        <property name="dataSource" ref="BSMUDPPushDataSource"/>
    </bean>


    <bean id="PushDataSource" class="com.leidos.ode.collector.datasource.PushDataSource" abstract="true"/>

    <bean id="RestPullDataSource" class="com.leidos.ode.collector.datasource.RestPullDataSource" abstract="true"/>

    <bean id="UDPPushDataSource" class="com.leidos.ode.collector.datasource.UDPPushDataSource" parent="PushDataSource">

    </bean>

    <bean id="JMSPushDataSource" class="com.leidos.ode.collector.datasource.JMSPushDataSource" parent="PushDataSource">
        <property name="hostProtocol" value="tcp://"/>
        <property name="hostAddress" value="localhost"/>
        <property name="hostPort" value="7847"/>
        <property name="username" value="leidos"/>
        <property name="password" value="H3SvjshHnNBX"/>
        <property name="queueName" value="Clients.leidos.ATIS.Events"/>
    </bean>

    <bean id="RITISFilterDataSource" class="com.leidos.ode.collector.RITISDataSource" parent="RestPullDataSource">
        <property name="hostProtocol" value="${leidos.ode.ritisfilter.protocol}"/>
        <property name="hostAddress" value="${leidos.ode.ritisfilter.sourceaddress}"/>
        <property name="baseUrl" value="${leidos.ode.ritisfilter.baseurl}"/>
        <property name="username" value="${leidos.ode.ritisfilter.username}"/>
        <property name="password" value="${leidos.ode.ritisfilter.password}"/>
        <property name="apiKey" value="${leidos.ode.ritisfilter.apikey}"/>
        <property name="requestLimit" value="${leidos.ode.ritisfilter.requestlimit}"/>
    </bean>

    <bean id="RITISSpeed" parent="RITISFilterDataSource">
        <property name="feedName" value="${leidos.ode.ritisfilter.detector.url}"/>
    </bean>

    <bean id="RITISWeather" parent="RITISFilterDataSource">
        <property name="feedName" value="${leidos.ode.ritisfilter.weather.url}"/>
    </bean>

    <bean id="RITISFilterAgent" class="com.leidos.ode.agent.PublishODEAgent">
        <property name="registration" ref="BasicPubRegistration"/>
        <property name="parser" ref="RITISParser"/>
        <property name="sanitizer" ref="PassthroughSanitizer"/>
        <property name="dataTarget" ref="QueueTarget"/>
        <property name="registrationInformation" ref="TestRegistrationInfo"/>
        <property name="odeLogger" ref="ODELogger"/>
    </bean>

    <bean id="RITISFilterCollector" class="com.leidos.ode.collector.ODECollector">
        <property name="agent" ref="RITISFilterAgent"/>
        <property name="dataSource" ref="RITISFilterDataSource"/>
    </bean>

    <bean id="VDOTDataSource" class="com.leidos.ode.collector.VDOTDataSource" parent="RestPullDataSource">
        <property name="hostProtocol" value="${leidos.ode.vdotfeeds.protocol}"/>
        <property name="hostAddress" value="${leidos.ode.vdotfeeds.sourceaddress}"/>
        <property name="baseUrl" value="${leidos.ode.vdotfeeds.wfsbaseurl}"/>
        <!--<property name="xmlBaseUrl" value="${leidos.ode.vdotfeeds.xmlbaseurl}"/>-->
        <property name="username" value="${leidos.ode.vdotfeeds.username}"/>
        <property name="password" value="${leidos.ode.vdotfeeds.password}"/>
    </bean>

    <bean id="VDOTWeather" parent="VDOTDataSource">
        <property name="feedName" value="${leidos.ode.vdotfeeds.shorttermweatherevents.wfsurl}"/>
    </bean>

    <bean id="VDOTSpeed" parent="VDOTDataSource">
        <property name="feedName" value="${leidos.ode.vdotfeeds.trafficsensorstations.wfsurl}"/>
    </bean>

    <bean id="VDOTTravelTime" parent="VDOTDataSource">
        <property name="feedName" value="${leidos.ode.vdotfeeds.traveltimesegments.wfsurl}"/>
    </bean>

    <bean id="VDOTAgent" class="com.leidos.ode.agent.PublishODEAgent">
        <property name="registration" ref="BasicPubRegistration"/>
        <property name="parser" ref="VDOTParser"/>
        <property name="sanitizer" ref="PassthroughSanitizer"/>
        <property name="dataTarget" ref="QueueTarget"/>
        <property name="registrationInformation" ref="TestRegistrationInfo"/>
        <property name="odeLogger" ref="ODELogger"/>
    </bean>

    <bean id="VDOTCollector" class="com.leidos.ode.collector.ODECollector">
        <property name="agent" ref="VDOTAgent"/>
        <property name="dataSource" ref="VDOTDataSource"/>
    </bean>

    <bean id="mongo" class="com.mongodb.Mongo">
        <constructor-arg name="host" value="127.0.0.1"/>
        <constructor-arg name="port" value="27017"/>
    </bean>

    <!-- Define the MongoTemplate which handles connectivity with MongoDB -->
    <bean id="mongoTemplate" class="org.springframework.data.mongodb.core.MongoTemplate">
        <constructor-arg name="mongo" ref="mongo"/>
        <constructor-arg name="databaseName" value="ode"/>
    </bean>

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~Data Controllers~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <bean id="PublishDataController" class="com.leidos.ode.core.controllers.PublishDataController" abstract="true">
        <property name="hostAddress" value="${leidos.ode.publisher.hostaddress}"/>
        <property name="hostPort" value="${leidos.ode.publisher.hostport}"/>
        <property name="connectionFactoryName" value="${leidos.ode.publisher.connectionfactoryname}"/>
    </bean>

    <bean id="PublishBSMDataController" class="com.leidos.ode.core.controllers.topics.PublishBSMDataController"
          parent="PublishDataController">
        <property name="topicName" value="${leidos.ode.publisher.topic.bsm}"/>
    </bean>

    <bean id="PublishVDOTWeatherDataController"
          class="com.leidos.ode.core.controllers.topics.PublishVDOTWeatherDataController"
          parent="PublishDataController">
        <property name="topicName" value="${leidos.ode.publisher.topic.vdotweather}"/>
    </bean>

    <bean id="PublishVDOTTravelTimeDataController"
          class="com.leidos.ode.core.controllers.topics.PublishVDOTTravelTimeDataController"
          parent="PublishDataController">
        <property name="topicName" value="${leidos.ode.publisher.topic.vdottraveltime}"/>
    </bean>

    <bean id="PublishVDOTSpdVolOccDataController"
          class="com.leidos.ode.core.controllers.topics.PublishVDOTSpdVolOccDataController"
          parent="PublishDataController">
        <property name="topicName" value="${leidos.ode.publisher.topic.vdotspdvolocc}"/>
    </bean>

    <bean id="PublishRITISSpdVolOccDataController"
          class="com.leidos.ode.core.controllers.topics.PublishRITISSpdVolOccDataController"
          parent="PublishDataController">
        <property name="topicName" value="${leidos.ode.publisher.topic.ritisspdvolocc}"/>
    </bean>

    <bean id="PublishRITISWeatherDataController"
          class="com.leidos.ode.core.controllers.topics.PublishRITISWeatherDataController"
          parent="PublishDataController">
        <property name="topicName" value="${leidos.ode.publisher.topic.ritisweather}"/>
    </bean>
</beans>