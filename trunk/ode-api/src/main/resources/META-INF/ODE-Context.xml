<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

    <!-- Load Properties file -->
    <bean id="properties" class="org.springframework.beans.factory.config.PropertiesFactoryBean" scope="prototype">
        <property name="ignoreResourceNotFound" value="true"/>
        <!--
        Allow for the (optional) override of these properties
        -->
        <property name="locations">
            <list>
                <value>classpath:META-INF/ODEContext-Dev.properties</value>
            </list>
        </property>
    </bean>

    <bean id="propertyPlaceholderConfigurer"
          class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="locations">
            <list>
                <value>classpath:ritisfilter.properties</value>
                <value>classpath:vdotfeeds.properties</value>
            </list>
        </property>
        <property name="properties" ref="properties"/>
        <!-- This means don't blow up if a property is not set -->
        <property name="ignoreUnresolvablePlaceholders" value="true"/>
        <!--
        This means that any system properties set on the command line will take precedence over those set locally or in a properties file.
        -->
        <property name="systemPropertiesModeName" value="SYSTEM_PROPERTIES_MODE_OVERRIDE"/>
    </bean>

    <bean id="dateFormat" class="java.text.SimpleDateFormat">
        <constructor-arg value="MM-dd-YYYY"/>
    </bean>

    <bean id="BasicSubRegistration" class="com.leidos.ode.agent.registration.SubscriberRegistration">
        <property name="regServiceAddress" value="${leidos.ode.regaddress}"/>
    </bean>

    <bean id="BasicPubRegistration" class="com.leidos.ode.agent.registration.PublisherRegistration">
        <property name="regServiceAddress" value="${leidos.ode.regaddress}"/>
    </bean>

    <bean id="BSMParser" class="com.leidos.ode.agent.parser.ODEBSMParser"/>

    <bean id="QueueTarget" class="com.leidos.ode.agent.datatarget.ODEQueueTarget"/>

    <bean id="VDOTParser" class="com.leidos.ode.agent.parser.ODEVDOTParser"/>

    <bean id="RITISParser" class="com.leidos.ode.agent.parser.ODERITISParser"/>

    <bean id="PassthroughSanitizer" class="com.leidos.ode.agent.sanitizer.PassthroughSanitizer">
    </bean>

    <bean id="TestRegistrationInfo" class="com.leidos.ode.core.registration.RegistrationInformation">
        <property name="messageType" value="${leidos.ode.reg.test.pub.messageType}"/>
        <property name="region" value="${leidos.ode.reg.test.pub.region}"/>
        <property name="registrationType" value="${leidos.ode.reg.test.pub.registrationType}"/>
        <property name="agentId" value="${leidos.ode.reg.test.pub.agentId}"/>
        <property name="startDate">
            <bean factory-bean="dateFormat" factory-method="parse">
                <constructor-arg value="${leidos.ode.reg.test.pub.startDate}"/>
            </bean>
        </property>
        <property name="endDate">
            <bean factory-bean="dateFormat" factory-method="parse">
                <constructor-arg value="${leidos.ode.reg.test.pub.endDate}"/>
            </bean>
        </property>
    </bean>

    <bean id="TestPubAgent" class="com.leidos.ode.agent.PublishODEAgent">
        <property name="registration" ref="BasicPubRegistration"/>
        <property name="parser" ref="BSMParser"/>
        <property name="sanitizer" ref="PassthroughSanitizer"/>
        <property name="dataTarget" ref="QueueTarget"/>
        <property name="regInfo" ref="TestRegistrationInfo"/>
    </bean>

    <bean id="RestPullDataSource" class="com.leidos.ode.collector.datasource.RestPullDataSource" abstract="true"/>

    <bean id="RITISFilterDataSource" class="com.leidos.ode.collector.RITISDataSource" parent="RestPullDataSource">
        <property name="hostProtocol" value="${leidos.ode.ritisfilter.protocol}"/>
        <property name="hostAddress" value="${leidos.ode.ritisfilter.sourceaddress}"/>
        <property name="baseUrl" value="${leidos.ode.ritisfilter.baseurl}"/>
        <property name="username" value="${leidos.ode.ritisfilter.username}"/>
        <property name="password" value="${leidos.ode.ritisfilter.password}"/>
        <property name="apiKey" value="${leidos.ode.ritisfilter.apikey}"/>
        <property name="requestLimit" value="${leidos.ode.ritisfilter.requestlimit}"/>
        <property name="collectorDataSourceListener" ref="RITISFilterCollector"/>
    </bean>

    <bean id="RITISFilterAgent" class="com.leidos.ode.agent.PublishODEAgent">
        <property name="registration" ref="BasicPubRegistration"/>
        <property name="parser" ref="RITISParser"/>
        <property name="sanitizer" ref="PassthroughSanitizer"/>
        <property name="dataTarget" ref="QueueTarget"/>
    </bean>

    <bean id="RITISFilterCollector" class="com.leidos.ode.collector.ODECollector">
        <property name="agent" ref="RITISFilterAgent"/>
        <property name="dataSource" ref="RITISFilterDataSource"/>
    </bean>

    <bean id="VDOTDataSource" class="com.leidos.ode.collector.VDOTDataSource" parent="RestPullDataSource">
        <property name="hostProtocol" value="${leidos.ode.vdotfeeds.protocol}"/>
        <property name="hostAddress" value="${leidos.ode.vdotfeeds.sourceaddress}"/>
        <property name="baseUrl" value="${leidos.ode.vdotfeeds.wfsbaseurl}"/>
        <!--<property name="xmlBaseUrl" value="${leidos.ode.vdotfeeds.xmlbaseurl}"/>-->
        <property name="username" value="${leidos.ode.vdotfeeds.username}"/>
        <property name="password" value="${leidos.ode.vdotfeeds.password}"/>
        <property name="collectorDataSourceListener" ref="VDOTCollector"/>
    </bean>

    <bean id="VDOTAgent" class="com.leidos.ode.agent.PublishODEAgent">
        <property name="registration" ref="BasicPubRegistration"/>
        <property name="parser" ref="VDOTParser"/>
        <property name="sanitizer" ref="PassthroughSanitizer"/>
        <property name="dataTarget" ref="QueueTarget"/>
    </bean>

    <bean id="VDOTCollector" class="com.leidos.ode.collector.ODECollector">
        <property name="agent" ref="VDOTAgent"/>
        <property name="dataSource" ref="VDOTDataSource"/>
    </bean>

    <bean id="mongo" class="com.mongodb.Mongo">
        <constructor-arg name="host" value="127.0.0.1"/>
        <constructor-arg name="port" value="27017"/>
    </bean>

    <!-- Define the MongoTemplate which handles connectivity with MongoDB -->
    <bean id="mongoTemplate" class="org.springframework.data.mongodb.core.MongoTemplate">
        <constructor-arg name="mongo" ref="mongo"/>
        <constructor-arg name="databaseName" value="ode"/>
    </bean>

    <bean id="PublishController" class="com.leidos.ode.core.controllers.publish.PublishController" abstract="true"/>

    <bean id="PublishBSMDataController" class="com.leidos.ode.core.controllers.publish.PublishBSMDataController"
          parent="PublishController">
        <property name="hostAddress" value=""/>
        <property name="hostPort" value=/>
        <property name="connectionFactoryName" value=""/>
        <property name="topicName" value=""/>
    </bean>

    <bean id="PublishRITISSpdVolOccDataController" class="com.leidos.ode.core.controllers.publish.PublishRITISSpdVolOccDataController" parent="PublishController">
        <property name="hostAddress" value=""/>
        <property name="hostPort" value=/>
        <property name="connectionFactoryName" value=""/>
        <property name="topicName" value=""/>
    </bean>

    <bean id="PublishTravelTimeDataController" class="com.leidos.ode.core.controllers.publish.PublishTravelTimeDataController" parent="PublishController">
        <property name="hostAddress" value=""/>
        <property name="hostPort" value=/>
        <property name="connectionFactoryName" value=""/>
        <property name="topicName" value=""/>
    </bean>

    <bean id="PublishVDOTSpdVolOccDataController" class="com.leidos.ode.core.controllers.publish.PublishVDOTSpdVolOccDataController" parent="PublishController">
        <property name="hostAddress" value=""/>
        <property name="hostPort" value=/>
        <property name="connectionFactoryName" value=""/>
        <property name="topicName" value=""/>
    </bean>

    <bean id="PublishVDOTWeatherDataController" class="com.leidos.ode.core.controllers.publish.PublishVDOTWeatherDataController" parent="PublishController">
        <property name="hostAddress" value=""/>
        <property name="hostPort" value=/>
        <property name="connectionFactoryName" value=""/>
        <property name="topicName" value=""/>
    </bean>

    <bean id="PublishVDOTWeatherDataController"
          class="com.leidos.ode.core.controllers.publish.PublishVDOTWeatherDataController" parent="PublishController">
        <property name="hostAddress" value=""/>
        <property name="hostPort" value=/>
        <property name="connectionFactoryName" value=""/>
        <property name="topicName" value=""/>
    </bean>
</beans>